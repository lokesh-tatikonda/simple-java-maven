pipeline{
    agent any

    tools{
        maven "Maven 1"
    }

    environment{
        name = "Lokesh"
    }

    parameters {
     choice choices:['dev','prod'] , name: 'select_env'
    }

    stages{
        stage("build"){
            steps{
                echo"This is build stage and $name ${params.select_env}" 
                sh "mvn clean package"
            }
            post{
                success{
                    archiveArtifacts artifacts : "**/target/*.jar"
                }
            }
        }
        stage("test"){
            when{expression{select_env == dev} beforeAgent true}
            parallel{
                stage('A stage'){
                    steps{
                        echo"This is test A"
                    }
                }
                stage('B stage'){
                    steps{
                        echo"This is test B"
                    }
                }
            }
        }
        stage("deploy"){
            when {expression {select_env == prod} beforeAgent true }
            steps{
                echo "This is deploy stage"
            }
        }
    }
}